<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>ParselyiOS: Proxy Server Wire Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="parsely_appicon_retina.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ParselyiOS
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">The Parsely iOS Toolkit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Proxy Server Wire Protocol </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Parsely pixel server accepts GET requests containing the information for single pageviews. For mobile devices, sending one request per pageview wastes battery. The Parsely SDK sends batches of events to a proxy server, which then splits the batches into individual requests for consumption by the pixel server. The Parsely SDK creates this batched request for you, but there are some cases where you might want to construct this batched request yourself.</p>
<h2>Elements of the Proxy Request</h2>
<p>All POST requests sent to <code><a href="http://pixel.parsely.com/mobileproxy">http://pixel.parsely.com/mobileproxy</a></code> must have a single argument <code>rqs</code>. All other aruments are ignored. The value of the <code>rqs</code> (requests) parameter is a <b>URL-encoded</b> JSON document that must have the following structure: </p>
<pre class="fragment">{
    "data":{
        "idsite":"samplesite.com",
        "parsely_uuid":"76e4c7f0afeb4e7643f5089235779937d9637b55"
        "appname":"ParselySDK",
        "manufacturer":"Apple",
        "os":"iPhone OS",
        "os_version":"6.1",
    },
    "events":[
        {
            "url":"http://samplesite.com/2013/03/20/obama-delinquent-with-budgets-always-on-time-with-ncaa-brackets-say-republicans/",
            "ts":1363796913.105937
        },
        {
            "postid":"91782365-12378561-457896",
            "ts":1363596915.229876
        },
        ...
        {
            "url":"http://samplesite.com/2013/03/18/the-spin-does-not-stop-here/",
            "ts":1363296917.195734
        }
    ]
}
</pre><p>The <code>data</code> variable is a document containing invariant data about the pixel requests - that is, data that is constant for all of the events being transmitted. The <code>events</code> variable is a list of documents containing data that differs per request. Note that it is permissible to mix <code>url</code>s and <code>postid</code>s in the same <code>events</code> array.</p>
<table class="doxtable">
<tr>
<th>Variable </th><th>Container </th><th>Description </th><th>Required </th><th>Example</th></tr>
<tr>
<td><code>idsite</code> </td><td><code>data</code> </td><td>The site ID where data should be stored </td><td>yes </td><td><code>"idsite":"samplesite.com"</code> </td></tr>
<tr>
<td><code>parsely_site_uuid</code> </td><td><code>data</code> </td><td>The UUID for the current user or device </td><td>yes </td><td><code>"parsely_site_uuid":"76e4c8f0afeb4e7643f5089235779937d9637b55"</code> </td></tr>
<tr>
<td><code>appname</code> </td><td><code>data</code> </td><td>The name of the current app (for mobile devices) </td><td>no </td><td><code>"appname":"MyCoolApp"</code> </td></tr>
<tr>
<td><code>manufacturer</code> </td><td><code>data</code> </td><td>The device manufacturer (for mobile devices) </td><td>no </td><td><code>"manufacturer":"Apple"</code> </td></tr>
<tr>
<td><code>os</code> </td><td><code>data</code> </td><td>The name of the operating system (mobile only) </td><td>no </td><td><code>"os":"iPhone OS"</code> </td></tr>
<tr>
<td><code>os_version</code> </td><td><code>data</code> </td><td>Operating system major and minor version </td><td>no </td><td><code>"os_version":"6.1"</code> </td></tr>
<tr>
<td><code>url</code> </td><td><code>events</code> </td><td>The canonical URL of the tracked post </td><td>yes, or <code>postid</code> </td><td><code>"url":"http://samplesite.com/2013/03/20/obama-reid-dragged-into-evolving-menendez-donor-scandal/"</code> </td></tr>
<tr>
<td><code>postid</code> </td><td><code>events</code> </td><td>The Parsely-unique string identifier for the post </td><td>yes, or <code>url</code> </td><td><code>"postid":"147136-1892374-1297856"</code> </td></tr>
<tr>
<td><code>ts</code> </td><td><code>events</code> </td><td>The UNIX timestamp of the event (seconds since epoch) </td><td>yes </td><td><code>"ts":1363796913.220884</code> </td></tr>
</table>
<p>A real request to the proxy server might look like this one, which contains two separate pageview events in the URL-encoded JSON document: </p>
<pre class="fragment">POST /mobileproxy HTTP/1.1
Host: pixel.parsely.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 213

rqs=%7B%22data%22%3A%7B%22os_version%22%3A%226.1%22%2C%22appname%22%3A%22HiParsely%22%2C%22parsely_uuid%22%3A%22ad926df27f7f39fe1417f41bac9ec8e40232680a%22%2C%22idsite%22%3A%22somesite.com%22%2C%22manufacturer%22%3A%22Apple%22%2C%22os%22%3A%22iPhone%20OS%22%7D%2C%22events%22%3A%5B%7B%22url%22%3A%22http%3A%5C%2F%5C%2Fsomesite.com%5C%2Fnot-a-real-url.html%22%2C%22ts%22%3A1363977322.65788%7D%2C%7B%22ts%22%3A1363977323.012882%2C%22postid%22%3A%2212353-983124-876153%22%7D%5D%7D
</pre><h2>Generating a UUID</h2>
<p>On desktop browsers, you can avoid generating a UUID by <a href="http://parsely.com/api/tracking_pixel.html#using-the-parse-ly-network-uuid">using the Parsely network UUID</a>.</p>
<p>Mobile apps that use the Parsely toolkit don't have to create their own UUIDs, as the SDK handles that. However, if you'd like to create your own, it must be guaranteed to be unique per device. The easiest way to guarantee uniqueness is to generate a UUID using the device MAC address. On iOS, see the <code>CFUUIDCreate()</code> function for a description of how to do this. Once you create the UUID, you should save it in persistent storage (for example, iOS' <code>NSUserDefaults</code> key-value store). </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 23 2013 11:48:34 for ParselyiOS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
